/*! whitewater-player - v1.0.0 - 2018-08-12 */

function Whitewater(a,b,c){"use strict";var d=null,e=0,f={x:0,y:0},g=0,h=new Image,i=[],j=null,k=null,l=null,m="",n={},o=null,p=!1,q=null,r=null;this.state="loading",this.currentFrame=0,this.progress=0,this.timestamp="00:00.000",this.maxTime="00:00.000",this.secondsElapsed=0;var s=function(){this.canvas.play=this.play,this.canvas.pause=this.pause,this.canvas.playpause=this.playpause,this.canvas.stop=this.stop}.bind(this),t=function(){"hidden"in document?(o="hidden",document.addEventListener("visibilitychange",J.bind(this),!1)):"mozHidden"in document?(o="mozHidden",document.addEventListener("mozvisibilitychange",J.bind(this),!1)):"msHidden"in document?(o="msHidden",document.addEventListener("msvisibilitychange",J.bind(this),!1)):"webkitHidden"in document?(o="webkitHidden",document.addEventListener("webkitvisibilitychange",J.bind(this),!1)):"onfocusin"in document?(document.addEventListener("focusin",J.bind(this,!1),!1),document.addEventListener("focusout",J.bind(this,!0),!1)):"onpageshow"in window?(window.addEventListener("pageshow",J.bind(this,!1),!1),window.addEventListener("pagehide",J.bind(this,!0),!1)):(window.addEventListener("focus",J.bind(this,!1),!1),window.addEventListener("blur",J.bind(this,!0),!1))}.bind(this),u=function(){if(++g>n.imagesRequired){this.canvas.setAttribute("data-state","ready"),this.state="ready";var a=new CustomEvent("whitewaterload",w());this.canvas.dispatchEvent(a),c.autoplay&&this.play()}}.bind(this),v=function(){var a=null;a=0===this.currentFrame?h:x(k[this.currentFrame-1]),d.drawImage(a,0,0),this.currentFrame++,G()}.bind(this),w=function(){return{detail:{video:this,currentFrame:this.currentFrame,progress:this.progress,timestamp:this.timestamp,maxTime:this.maxTime,state:this.state,secondsElapsed:this.secondsElapsed},bubbles:!0,cancelable:!1}}.bind(this),x=function(a){r.clearRect(0,0,n.videoWidth,n.videoHeight);for(var b=0;b<a.length;b++){var c=a[b][0],d=a[b][1],g=M(c),h=d*n.blockSize;if(r.drawImage(i[e],f.x*n.blockSize,f.y*n.blockSize,h,n.blockSize,g[0]*n.blockSize,g[1]*n.blockSize,h,n.blockSize),f.x+=d,f.x>=n.sourceGrid&&(f.x=0,++f.y>=n.sourceGrid&&(f.y=0,++e>=i.length)))throw"imageIndex exceeded diffImages.length\n\nmapLength = "+a.length+"\nj = "+b}return q},y=function(){h.addEventListener("load",function(){u(),F()},!1),h.src=m+"first."+n.format;for(var a=1;a<=n.imagesRequired;a++){var b=new Image;b.addEventListener("load",u,!1),b.src=a>99?m+"diff_"+a+"."+n.format:a>9?m+"diff_0"+a+"."+n.format:m+"diff_00"+a+"."+n.format,i.push(b)}}.bind(this),z=function(a){function b(){try{l=JSON.parse(e.responseText)}catch(a){return void this.constructor._throwError(a)}I(),H();var b=null,d=function(){function a(a){for(var b,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0;a.length;)b=c.indexOf(a.charAt(0)),a=a.substr(1),d*=64,d+=b;return d}var b=!1;return b=!0,onmessage=function(b){for(var c=b.data,d=[],e=0;e<c.length;e++){var f=c[e],g=[];if(""!==f)for(var h=f.match(/.{1,5}/g),i=h.length,j=0;j<i;j++){var k=a(h[j].substr(0,3)),l=a(h[j].substr(3,2));g.push([k,l])}d.push(g)}postMessage(d)},b},f=window.URL||window.webkitURL,g=new Blob(["("+d.toString()+")()"],{type:"text/javascript"});b=new Worker(f.createObjectURL(g)),b.postMessage(l.frames),b.onmessage=function(d){k=d.data,b.terminate();for(var e=0;e<a.length;e++)a[e]();c.controls&&E()}}function d(){try{throw this.constructor.errors.MANIFEST}catch(a){return void this.constructor._throwError(a)}}var e=new XMLHttpRequest;e.open("GET",m+"manifest.json",!0),e.addEventListener("load",b.bind(this),!1),e.addEventListener("error",d.bind(this),!1),e.send()}.bind(this),A=function(){e=0,f.x=0,f.y=0,this.currentFrame=0,d.clearRect(0,0,n.videoWidth,n.videoHeight)}.bind(this),B=function(){if(!(a instanceof HTMLCanvasElement))throw this.constructor.errors.CANVAS;this.canvas=a,d=this.canvas.getContext("2d"),q=document.createElement("canvas"),r=q.getContext("2d")}.bind(this),C=function(){if("string"!=typeof b)throw this.constructor.errors.PATH;m=b,"/"!==b.substr(-1)&&(m+="/")},D=function(){if(c){var a=1;c.speed&&c.speed<1&&(a=c.speed),c={loop:c.loop||!1,autoplay:c.autoplay||!1,controls:c.controls||!1,speed:a}}},E=function(){var a=this.canvas;"boolean"!=typeof c.controls&&(a=c.controls);var b=L();a.addEventListener(b,this.playpause)}.bind(this),F=function(){var a=h.src,b=this.canvas.style.paddingTop;this.canvas.style.background="transparent url("+a+") no-repeat center "+b,this.canvas.style.backgroundSize="contain"}.bind(this),G=function(){this.progress=O(this.currentFrame/n.frameCount*100,3);var a=this.currentFrame/n.framesPerSecond;this.timestamp=N(a),this.secondsElapsed=O(a,3)}.bind(this),H=function(){this.canvas.setAttribute("width",n.videoWidth+"px"),this.canvas.setAttribute("height",n.videoHeight+"px"),q.width=n.videoWidth,q.height=n.videoHeight}.bind(this),I=function(){var a="";switch(l.format){case"JPEG":a="jpg";break;case"PNG":a="png";break;case"GIF":a="gif";break;default:a="jpg"}n={videoWidth:l.videoWidth,videoHeight:l.videoHeight,imagesRequired:l.imagesRequired,frameCount:l.frameCount-1,blockSize:l.blockSize,sourceGrid:l.sourceGrid,framesPerSecond:Math.round(l.framesPerSecond),format:a};var b=n.frameCount/n.framesPerSecond;this.maxTime=N(b)}.bind(this),J=function(a){void 0!==a&&(p=a),!document[o]&&!0!==p||"playing"!==P.state?"suspended"===P.state&&this.play():(this.state="suspended",this.pause())},K=function(){try{B(),C(),D();z([y,s,t])}catch(a){return void this.constructor._throwError(a)}}.bind(this),L=function(){return"ontouchstart"in document.documentElement?"touchend":"mouseup"},M=function(a){var b=Math.ceil(n.videoWidth/n.blockSize);return a<b?[a,0]:[a%b,Math.floor(a/b)]},N=function(a){var b=Math.floor(a/60),c=Math.floor(a%60),d=Math.floor(a%60%1*1e3);return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10?d="00"+d:d<100&&(d="0"+d),b+":"+c+"."+d},O=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},P=this;this.pause=function(){if("paused"!==P.state){if("suspended"!==P.state){P.canvas.setAttribute("data-state","paused"),P.state="paused";var a=new CustomEvent("whitewaterpause",w());P.canvas.dispatchEvent(a)}cancelAnimationFrame(j)}},this.play=function(){function a(b){var d=b-g;if(d>=f){if(P.currentFrame<n.frameCount+1)v();else if(c.loop){A(),v();var e=new CustomEvent("whitewaterloop",w());P.canvas.dispatchEvent(e)}else{P.stop(),P.canvas.setAttribute("data-state","ended"),P.state="ended";new CustomEvent("whitewaterend",w())}g=b-(d-f)}document[o]||!0===p||"playing"!==P.state||(j=requestAnimationFrame(a))}if("playing"!==P.state){"ended"===P.state&&A();var b="suspended"===P.state;if(P.canvas.setAttribute("data-state","playing"),P.state="playing",!b){var d=new CustomEvent("whitewaterplay",w());P.canvas.dispatchEvent(d)}var e=1/n.framesPerSecond*1e3,f=O(e/c.speed,2),g=window.performance.now();a(g)}},this.playpause=function(){"playing"===P.state?P.pause():"loading"!==P.state&&P.play()},this.stop=function(){if("ready"!==P.state){P.canvas.setAttribute("data-state","ready"),P.state="ready";var a=new CustomEvent("whitewaterend",w());P.canvas.dispatchEvent(a),cancelAnimationFrame(j),A(),G()}},Whitewater.supported&&K()}Whitewater.errors={pre:"Whitewater: ",MISC:"Whatever.",WEBWORKERS:"This browser does not support Web Workers.",BLOBCONSTRUCTOR:"This browser does not support the Blob() constructor.",VISIBILITYAPI:"This browser does not support the Visiblity API",CANVAS:'"canvas" must be a valid HTML canvas element.',PATH:'"path" must be a path to a directory containing a manifest.json file',MANIFEST:"A manifest.json file could not be found."},Whitewater._checkSupport=function(){try{if(window.Blob){if(window.Worker){if("hidden"in document||"mozHidden"in document||"msHidden"in document||"webkitHidden"in document)return!0;throw this.errors.VISIBILITYAPI}throw this.errors.BLOBCONSTRUCTOR}throw this.errors.WEBWORKERS}catch(a){return this._throwError(a),!1}},Whitewater._throwError=function(a){console.warn(this.errors.pre+a)},Whitewater.supported=Whitewater._checkSupport();
//# sourceMappingURL=whitewater.min.js.map
